{
  "title": "Two-Factor Authentication QA",
  "storageKey": "qa-two-factor-auth",
  "testingOrder": "Start with Section 1 (setup). Test login flows in Section 2. Then admin controls in Section 3. Test mobile in Section 4.",
  "sections": [
    {
      "title": "1. 2FA Setup (Settings > Preferences)",
      "groups": [
        {
          "name": "Enable 2FA",
          "items": [
            "Settings > Preferences shows 'Two-Factor Authentication' section with 'Disabled' badge",
            "Click 'Enable 2FA' → modal opens with QR code and 6-digit split input",
            "'Enable 2FA' button remains visible behind the modal overlay",
            "QR code is scannable with Google Authenticator / Authy",
            "'Can't scan? Enter manually' link shows base32 secret key",
            "Secret key field is centered, narrower than full width (fits text)",
            "Secret key text is centered inside the field",
            "Manual entry secret works when typed into authenticator app",
            "6-digit TOTP input: each box is separate, typing advances to next box",
            "Backspace in an empty box moves focus to previous box",
            "Pasting a 6-digit code fills all boxes and auto-submits",
            "Enter wrong 6-digit code → shows error notification inside modal",
            "Enter correct 6-digit code → modal shows backup codes grid",
            "'Copy All' button copies all 10 backup codes to clipboard",
            "Closing modal after setup → 2FA status changes to '✓ Enabled' badge",
            "Backup codes are in XXXX-XXXX format (uppercase hex)"
          ]
        },
        {
          "name": "Disable 2FA",
          "items": [
            "When 2FA is enabled, 'Disable 2FA' button is visible (red)",
            "Click 'Disable 2FA' → modal opens prompting for current password",
            "Enter wrong password → shows error inside modal",
            "Enter correct password → 2FA disabled, modal closes, status changes to 'Disabled'",
            "Cancel button inside modal closes it without changes"
          ]
        },
        {
          "name": "Regenerate Backup Codes",
          "items": [
            "When 2FA is enabled, 'Regenerate Backup Codes' button is visible",
            "Click → modal opens prompting for current password",
            "Enter correct password → modal shows new set of 10 backup codes",
            "Old backup codes no longer work after regeneration",
            "Toast notification: 'Backup codes regenerated'"
          ]
        }
      ]
    },
    {
      "title": "2. Login with 2FA",
      "groups": [
        {
          "name": "TOTP Login",
          "items": [
            "Log out, then log in with correct username/password → shows 2FA verification screen",
            "2FA screen shows 6 separate digit boxes with numeric keyboard on mobile",
            "Typing a digit auto-advances to next box",
            "Backspace in empty box moves to previous box",
            "Pasting a 6-digit code fills all boxes",
            "Enter correct TOTP code → auto-submits and logs in, redirects to dashboard",
            "Enter wrong code → shows 'Invalid verification code' with attempts remaining",
            "After 5 wrong attempts → shows 'Too many attempts' and returns to login",
            "'← Back to login' link returns to username/password form"
          ]
        },
        {
          "name": "Backup Code Login",
          "items": [
            "On 2FA screen, click 'Use a backup code' → shows text input for backup code",
            "Enter valid backup code → logs in successfully",
            "Same backup code cannot be used twice (consumed after first use)",
            "'Use authenticator app' link switches back to TOTP input"
          ]
        },
        {
          "name": "Non-2FA Login",
          "items": [
            "User without 2FA enabled → logs in directly (no 2FA prompt)",
            "Login response includes twofaEnabled: false for non-2FA users"
          ]
        }
      ]
    },
    {
      "title": "3. Admin Controls",
      "groups": [
        {
          "name": "2FA Badges on User Cards",
          "items": [
            "Settings > Users & Permissions shows '2FA' green badge on users with 2FA enabled",
            "Users without 2FA do not show the badge",
            "Badge is visible alongside role badge (Owner/Admin/Member)"
          ]
        },
        {
          "name": "Reset 2FA",
          "items": [
            "Owner sees 'Reset 2FA' button on admin and member user cards (when 2FA enabled)",
            "Admin sees 'Reset 2FA' button only on member user cards (when 2FA enabled)",
            "Click 'Reset 2FA' → shows 'Confirm Reset' confirmation",
            "Confirm → 2FA disabled for target user, '2FA' badge removed",
            "Toast: '2FA reset for [Name]'",
            "Owner cannot reset own 2FA via this button (uses disable instead)",
            "Admin cannot reset another admin's 2FA"
          ]
        },
        {
          "name": "2FA Requirement Toggles",
          "items": [
            "Owner sees '2FA Requirements' section below user list",
            "Admins do NOT see the requirements section",
            "Members do NOT see the requirements section",
            "'Require 2FA for Admins' toggle works and persists across page reload",
            "'Require 2FA for Members' toggle works and persists across page reload",
            "Toast notification on toggle change"
          ]
        },
        {
          "name": "Forced 2FA Setup",
          "items": [
            "Enable 'Require 2FA for Members' as owner",
            "Log in as a member without 2FA → redirected to /setup-2fa page",
            "Setup page shows QR code and requires completing 2FA before continuing",
            "Cannot navigate away from /setup-2fa until 2FA is configured",
            "After completing setup → 'Continue to Ledger' redirects to dashboard",
            "Subsequent logins prompt for TOTP code normally"
          ]
        }
      ]
    },
    {
      "title": "4. Mobile Responsiveness",
      "groups": [
        {
          "name": "2FA Login Screen",
          "items": [
            "2FA verification screen renders correctly on mobile (full width)",
            "TOTP input has numeric keyboard (inputMode=numeric)",
            "Backup code input works on mobile",
            "'Use a backup code' / 'Back to login' links are touch-friendly"
          ]
        },
        {
          "name": "Settings 2FA Section",
          "items": [
            "Enable/Disable/Regenerate buttons are full-width on mobile",
            "2FA flows open as bottom sheet on mobile (not centered modal)",
            "QR code is visible and scannable inside bottom sheet",
            "6-digit split input boxes are properly sized in bottom sheet",
            "Backup codes grid fits within bottom sheet on mobile",
            "2FA requirement toggles display correctly on mobile"
          ]
        },
        {
          "name": "Forced Setup Page",
          "items": [
            "TwoFASetupPage renders correctly on mobile",
            "QR code fits within the card width",
            "Backup codes are readable and copyable"
          ]
        }
      ]
    },
    {
      "title": "5. Edge Cases",
      "groups": [
        {
          "name": "Security",
          "items": [
            "Temp token expires after 5 minutes — re-login required",
            "Temp token cannot be used to access protected API endpoints",
            "Password required to disable 2FA (not just being logged in)",
            "Password required to regenerate backup codes",
            "Backup codes are single-use — second attempt with same code fails"
          ]
        },
        {
          "name": "Dark Mode",
          "items": [
            "2FA login screen renders correctly in dark mode",
            "QR code background stays white in dark mode (readable)",
            "Backup codes are readable in dark mode",
            "Settings 2FA section follows dark mode theme"
          ]
        }
      ]
    }
  ]
}
